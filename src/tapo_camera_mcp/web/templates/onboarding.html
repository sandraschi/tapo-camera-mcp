<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <meta name="description" content="{{ description }}">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react.production.min.js"></script>
    
    <!-- Chart.js for energy charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    
    <style>
        /* Custom styles for onboarding */
        .onboarding-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .onboarding-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .device-icon {
            transition: transform 0.2s ease;
        }
        
        .device-icon:hover {
            transform: scale(1.1);
        }
        
        .step-indicator {
            transition: all 0.3s ease;
        }
        
        .step-indicator.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .step-indicator.completed {
            background: #10b981;
            color: white;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
        }
        
        .device-card {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .device-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.1);
        }
        
        .device-card.configured {
            border-color: #10b981;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(16, 185, 129, 0.1) 100%);
        }
        
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="onboarding-root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Icon components
        const Search = () => React.createElement(lucide.Search, { className: "h-5 w-5" });
        const CheckCircle = () => React.createElement(lucide.CheckCircle, { className: "h-5 w-5" });
        const AlertCircle = () => React.createElement(lucide.AlertCircle, { className: "h-5 w-5" });
        const Clock = () => React.createElement(lucide.Clock, { className: "h-5 w-5" });
        const Zap = () => React.createElement(lucide.Zap, { className: "h-5 w-5" });
        const Shield = () => React.createElement(lucide.Shield, { className: "h-5 w-5" });
        const Camera = () => React.createElement(lucide.Camera, { className: "h-5 w-5" });
        const Wifi = () => React.createElement(lucide.Wifi, { className: "h-5 w-5" });
        const Settings = () => React.createElement(lucide.Settings, { className: "h-5 w-5" });
        const ArrowRight = () => React.createElement(lucide.ArrowRight, { className: "h-4 w-4" });
        const ArrowLeft = () => React.createElement(lucide.ArrowLeft, { className: "h-4 w-4" });
        const Home = () => React.createElement(lucide.Home, { className: "h-5 w-5" });
        const Smartphone = () => React.createElement(lucide.Smartphone, { className: "h-5 w-5" });
        const Monitor = () => React.createElement(lucide.Monitor, { className: "h-5 w-5" });

        // Main Onboarding Dashboard Component
        function OnboardingDashboard() {
            const [currentStep, setCurrentStep] = useState(0);
            const [discoveredDevices, setDiscoveredDevices] = useState([]);
            const [onboardingProgress, setOnboardingProgress] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);

            const onboardingSteps = [
                {
                    id: 'discovery',
                    title: 'Device Discovery',
                    description: 'Scanning for available devices on your network',
                    icon: React.createElement(Search)
                },
                {
                    id: 'configuration',
                    title: 'Device Configuration',
                    description: 'Configure device names, locations, and settings',
                    icon: React.createElement(Settings)
                },
                {
                    id: 'authentication',
                    title: 'Authentication Setup',
                    description: 'Set up authentication for protected devices',
                    icon: React.createElement(Shield)
                },
                {
                    id: 'integration',
                    title: 'Integration Setup',
                    description: 'Configure device integrations and automation',
                    icon: React.createElement(Wifi)
                },
                {
                    id: 'completion',
                    title: 'Onboarding Complete',
                    description: 'Review and finalize your device setup',
                    icon: React.createElement(CheckCircle)
                }
            ];

            useEffect(() => {
                startDeviceDiscovery();
            }, []);

            const startDeviceDiscovery = async () => {
                setLoading(true);
                setError(null);
                
                try {
                    // Simulate device discovery API call
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // Mock discovered devices
                    const mockDevices = [
                        {
                            device_id: 'tapo_p115_001',
                            device_type: 'tapo_p115',
                            display_name: 'Smart Plug 101',
                            ip_address: '192.168.1.101',
                            mac_address: '00:11:22:33:44:55',
                            model: 'Tapo P115',
                            location: 'Living Room',
                            capabilities: ['energy_monitoring', 'power_control', 'scheduling'],
                            requires_auth: true,
                            status: 'discovered'
                        },
                        {
                            device_id: 'tapo_p115_002',
                            device_type: 'tapo_p115',
                            display_name: 'Smart Plug 102',
                            ip_address: '192.168.1.102',
                            mac_address: '00:11:22:33:44:56',
                            model: 'Tapo P115',
                            location: 'Kitchen',
                            capabilities: ['energy_monitoring', 'power_control', 'scheduling'],
                            requires_auth: true,
                            status: 'discovered'
                        },
                        {
                            device_id: 'usb_webcam_0',
                            device_type: 'webcam',
                            display_name: 'USB Webcam',
                            model: 'USB Webcam',
                            location: 'Office',
                            capabilities: ['video_streaming', 'snapshot_capture'],
                            requires_auth: false,
                            status: 'discovered'
                        },
                        {
                            device_id: 'nest_protect_001',
                            device_type: 'nest_protect',
                            display_name: 'Nest Protect - Kitchen',
                            model: 'Nest Protect 2nd Gen',
                            location: 'Kitchen',
                            capabilities: ['smoke_detection', 'co_detection', 'battery_monitoring'],
                            requires_auth: true,
                            status: 'discovered'
                        }
                    ];
                    
                    setDiscoveredDevices(mockDevices);
                    setCurrentStep(1);
                    
                    setOnboardingProgress({
                        current_step: 1,
                        total_devices_discovered: mockDevices.length,
                        devices_configured: 0,
                        completed_steps: ['discovery'],
                        onboarding_complete: false,
                        last_updated: new Date().toISOString()
                    });
                    
                } catch (err) {
                    setError('Failed to discover devices. Please check your network connection.');
                } finally {
                    setLoading(false);
                }
            };

            const getDeviceIcon = (deviceType) => {
                switch (deviceType) {
                    case 'tapo_p115':
                        return React.createElement(Zap, { className: "h-5 w-5 text-blue-500" });
                    case 'nest_protect':
                        return React.createElement(Shield, { className: "h-5 w-5 text-red-500" });
                    case 'ring':
                        return React.createElement(Smartphone, { className: "h-5 w-5 text-yellow-500" });
                    case 'webcam':
                        return React.createElement(Camera, { className: "h-5 w-5 text-green-500" });
                    default:
                        return React.createElement(Monitor, { className: "h-5 w-5 text-gray-500" });
                }
            };

            const getDeviceTypeLabel = (deviceType) => {
                switch (deviceType) {
                    case 'tapo_p115':
                        return 'Tapo P115 Smart Plug';
                    case 'nest_protect':
                        return 'Nest Protect';
                    case 'ring':
                        return 'Ring Device';
                    case 'webcam':
                        return 'USB Webcam';
                    default:
                        return 'Unknown Device';
                }
            };

            const renderDiscoveryStep = () => (
                React.createElement('div', { className: "space-y-6 fade-in" },
                    React.createElement('div', { className: "text-center" },
                        React.createElement(Search, { className: "h-16 w-16 mx-auto mb-4 text-blue-500" }),
                        React.createElement('h2', { className: "text-2xl font-bold mb-2" }, "Discovering Your Devices"),
                        React.createElement('p', { className: "text-gray-600" }, 
                            "Scanning your network for Tapo P115 smart plugs, Nest Protect devices, Ring alarms, and USB webcams..."
                        )
                    ),
                    loading && React.createElement('div', { className: "flex items-center justify-center py-8" },
                        React.createElement('div', { className: "loading-spinner rounded-full h-8 w-8 border-b-2 border-blue-600" })
                    ),
                    error && React.createElement('div', { className: "bg-red-50 border border-red-200 rounded-lg p-4" },
                        React.createElement('div', { className: "flex items-center gap-2" },
                            React.createElement(AlertCircle, { className: "h-5 w-5 text-red-600" }),
                            React.createElement('span', { className: "text-red-800" }, error)
                        )
                    )
                )
            );

            const renderConfigurationStep = () => (
                React.createElement('div', { className: "space-y-6 fade-in" },
                    React.createElement('div', { className: "text-center" },
                        React.createElement(Settings, { className: "h-16 w-16 mx-auto mb-4 text-green-500" }),
                        React.createElement('h2', { className: "text-2xl font-bold mb-2" }, "Configure Your Devices"),
                        React.createElement('p', { className: "text-gray-600" }, 
                            "Give your devices friendly names and assign them to locations for easy management."
                        )
                    ),
                    React.createElement('div', { className: "grid gap-4" },
                        discoveredDevices.map((device) => 
                            React.createElement(DeviceConfigCard, {
                                key: device.device_id,
                                device: device,
                                onUpdate: (updates) => {
                                    setDiscoveredDevices(prev => 
                                        prev.map(d => 
                                            d.device_id === device.device_id 
                                                ? { ...d, ...updates, status: 'configured' }
                                                : d
                                        )
                                    );
                                }
                            })
                        )
                    ),
                    React.createElement('div', { className: "flex justify-between" },
                        React.createElement('button', {
                            className: "px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2",
                            onClick: () => setCurrentStep(0)
                        }, React.createElement(ArrowLeft), "Back to Discovery"),
                        React.createElement('button', {
                            className: "px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",
                            onClick: () => setCurrentStep(2)
                        }, "Continue to Authentication", React.createElement(ArrowRight))
                    )
                )
            );

            const renderCurrentStep = () => {
                switch (currentStep) {
                    case 0:
                        return renderDiscoveryStep();
                    case 1:
                        return renderConfigurationStep();
                    default:
                        return renderDiscoveryStep();
                }
            };

            return (
                React.createElement('div', { className: "min-h-screen bg-gray-50 py-8" },
                    React.createElement('div', { className: "max-w-4xl mx-auto px-4" },
                        // Progress Header
                        React.createElement('div', { className: "mb-8" },
                            React.createElement('div', { className: "flex items-center justify-between mb-4" },
                                React.createElement('h1', { className: "text-3xl font-bold" }, "Device Onboarding"),
                                onboardingProgress && React.createElement('span', {
                                    className: "px-3 py-1 bg-gray-200 text-gray-700 rounded-full text-sm"
                                }, `${onboardingProgress.devices_configured} / ${onboardingProgress.total_devices_discovered} configured`)
                            ),
                            React.createElement('div', { className: "space-y-2" },
                                React.createElement('div', { className: "w-full bg-gray-200 rounded-full h-2" },
                                    React.createElement('div', {
                                        className: "progress-bar h-2 rounded-full",
                                        style: { width: `${(currentStep / (onboardingSteps.length - 1)) * 100}%` }
                                    })
                                ),
                                React.createElement('div', { className: "flex justify-between text-sm text-gray-600" },
                                    onboardingSteps.map((step, index) =>
                                        React.createElement('div', {
                                            key: step.id,
                                            className: `flex items-center gap-2 step-indicator ${currentStep >= index ? 'active' : ''} px-2 py-1 rounded`
                                        },
                                            currentStep > index ? 
                                                React.createElement(CheckCircle, { className: "h-4 w-4" }) :
                                                currentStep === index ?
                                                    React.createElement(Clock, { className: "h-4 w-4" }) :
                                                    React.createElement('div', { className: "h-4 w-4 rounded-full border-2 border-gray-300" }),
                                            React.createElement('span', {
                                                className: currentStep >= index ? 'text-gray-900' : 'text-gray-400'
                                            }, step.title)
                                        )
                                    )
                                )
                            )
                        ),
                        // Current Step Content
                        React.createElement('div', { className: "onboarding-card rounded-lg shadow-lg p-8" },
                            renderCurrentStep()
                        )
                    )
                )
            );
        }

        // Device Configuration Card Component
        function DeviceConfigCard({ device, onUpdate }) {
            const [displayName, setDisplayName] = useState(device.display_name);
            const [location, setLocation] = useState(device.location || '');

            const handleSave = () => {
                onUpdate({
                    display_name: displayName,
                    location: location
                });
            };

            const getDeviceIcon = (deviceType) => {
                switch (deviceType) {
                    case 'tapo_p115':
                        return React.createElement(Zap, { className: "h-5 w-5 text-blue-500" });
                    case 'nest_protect':
                        return React.createElement(Shield, { className: "h-5 w-5 text-red-500" });
                    case 'ring':
                        return React.createElement(Smartphone, { className: "h-5 w-5 text-yellow-500" });
                    case 'webcam':
                        return React.createElement(Camera, { className: "h-5 w-5 text-green-500" });
                    default:
                        return React.createElement(Monitor, { className: "h-5 w-5 text-gray-500" });
                }
            };

            return (
                React.createElement('div', {
                    className: `device-card ${device.status === 'configured' ? 'configured' : ''} bg-white rounded-lg border p-6`
                },
                    React.createElement('div', { className: "flex items-center gap-2 mb-4" },
                        getDeviceIcon(device.device_type),
                        React.createElement('h3', { className: "text-lg font-semibold" }, device.model)
                    ),
                    React.createElement('div', { className: "space-y-4" },
                        React.createElement('div', null,
                            React.createElement('label', {
                                className: "block text-sm font-medium text-gray-700 mb-1"
                            }, "Device Name"),
                            React.createElement('input', {
                                type: "text",
                                value: displayName,
                                onChange: (e) => setDisplayName(e.target.value),
                                placeholder: "Enter a friendly name",
                                className: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', {
                                className: "block text-sm font-medium text-gray-700 mb-1"
                            }, "Location"),
                            React.createElement('input', {
                                type: "text",
                                value: location,
                                onChange: (e) => setLocation(e.target.value),
                                placeholder: "Enter device location",
                                className: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            })
                        ),
                        device.ip_address && React.createElement('div', null,
                            React.createElement('label', {
                                className: "block text-sm font-medium text-gray-700 mb-1"
                            }, "IP Address"),
                            React.createElement('p', { className: "text-sm text-gray-600" }, device.ip_address)
                        ),
                        React.createElement('div', null,
                            React.createElement('label', {
                                className: "block text-sm font-medium text-gray-700 mb-1"
                            }, "Capabilities"),
                            React.createElement('div', { className: "flex flex-wrap gap-2" },
                                device.capabilities.map((capability) =>
                                    React.createElement('span', {
                                        key: capability,
                                        className: "px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs"
                                    }, capability.replace('_', ' '))
                                )
                            )
                        ),
                        React.createElement('button', {
                            onClick: handleSave,
                            className: "w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                        }, "Save Configuration")
                    )
                )
            );
        }

        // Render the app
        ReactDOM.render(React.createElement(OnboardingDashboard), document.getElementById('onboarding-root'));
    </script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</body>
</html>

# Tapo Camera MCP - Project-Specific Cursor Rules

## üéØ Project Overview

**Tapo Camera MCP Server** - Hardware integration for TP-Link Tapo cameras via MCP protocol

This project specializes in:
- üìπ **Camera Hardware Integration** - Direct communication with Tapo devices
- üîå **Network Protocols** - HTTP/HTTPS, WebSocket, RTSP streaming
- üõ°Ô∏è **Security Management** - Camera authentication and secure access
- üìä **Real-time Monitoring** - Live video feeds and device status
- üîß **Device Management** - Camera configuration and control

---

## üö® CRITICAL: Hardware-Specific Guidelines

### **Camera Connection Standards**
- **Always validate camera connectivity** before performing operations
- **Implement proper timeout handling** for network operations (5-30 seconds)
- **Use connection pooling** for multiple camera operations
- **Handle camera offline states gracefully** with clear error messages

### **Security Requirements**
- **Never log camera credentials** in plain text
- **Use secure credential storage** (encrypted config files)
- **Implement proper authentication** for all camera operations
- **Validate camera certificates** for HTTPS connections
- **Rate limit camera requests** to prevent device overload

### **Network Protocol Guidelines**
- **HTTP/HTTPS**: Use proper headers and error handling
- **WebSocket**: Implement reconnection logic for dropped connections
- **RTSP**: Handle stream initialization failures gracefully
- **UDP**: Use for real-time data where appropriate

---

## üîß MCP-Specific Development Standards

### **Tool Naming Conventions**
- **Camera Operations**: `camera_*` prefix (e.g., `camera_get_status`, `camera_start_stream`)
- **Device Management**: `device_*` prefix (e.g., `device_list`, `device_configure`)
- **Streaming**: `stream_*` prefix (e.g., `stream_start`, `stream_stop`)
- **Security**: `auth_*` prefix (e.g., `auth_login`, `auth_logout`)

### **Error Handling Patterns**
```python
# Standard error response format
{
    "error": "CAMERA_CONNECTION_FAILED",
    "message": "Unable to connect to camera at 192.168.1.100",
    "details": {
        "camera_id": "tapo_c200_001",
        "ip_address": "192.168.1.100",
        "timeout": 30,
        "retry_count": 3
    },
    "suggestions": [
        "Check camera power and network connection",
        "Verify IP address is correct",
        "Check firewall settings"
    ]
}
```

### **Configuration Management**
- **Camera Config**: Store in `config.yaml` with encrypted credentials
- **Network Settings**: Separate network configuration section
- **Stream Settings**: Video quality and format preferences
- **Security Settings**: Authentication and encryption options

---

## üìπ Camera-Specific Documentation Standards

### **API Documentation Requirements**
- **Camera Models**: Document supported Tapo camera models
- **Connection Methods**: HTTP, WebSocket, RTSP protocols
- **Authentication**: Login flows and credential management
- **Streaming**: Video stream formats and quality settings
- **Error Codes**: Complete error code reference

### **Hardware Integration Docs**
- **Device Discovery**: How to find and connect to cameras
- **Network Requirements**: Ports, protocols, and firewall settings
- **Power Management**: Camera power states and wake-up procedures
- **Firmware Compatibility**: Supported firmware versions

### **Troubleshooting Guides**
- **Connection Issues**: Common network problems and solutions
- **Authentication Failures**: Credential and permission issues
- **Stream Problems**: Video quality and connectivity issues
- **Device Offline**: Recovery procedures and diagnostics

---

## üõ°Ô∏è Security-Specific Guidelines

### **Credential Management**
- **Encryption**: Use AES-256 for stored credentials
- **Environment Variables**: Support for credential injection
- **Rotation**: Implement credential rotation procedures
- **Audit**: Log all authentication attempts

### **Network Security**
- **TLS/SSL**: Enforce HTTPS for all camera communications
- **Certificate Validation**: Verify camera certificates
- **Firewall Rules**: Document required port configurations
- **VPN Support**: Support for secure remote access

### **Data Protection**
- **Video Data**: Handle video streams securely
- **Metadata**: Protect camera metadata and settings
- **Logs**: Sanitize logs to remove sensitive information
- **Backup**: Secure backup procedures for configurations

---

## üìä Monitoring and Diagnostics

### **Health Checks**
- **Camera Status**: Regular connectivity checks
- **Stream Health**: Monitor video stream quality
- **Network Latency**: Track response times
- **Error Rates**: Monitor failure patterns

### **Performance Metrics**
- **Response Times**: Track API response times
- **Stream Quality**: Monitor video quality metrics
- **Resource Usage**: CPU and memory consumption
- **Network Usage**: Bandwidth utilization

### **Alerting**
- **Camera Offline**: Immediate alerts for disconnected cameras
- **Stream Failures**: Alerts for video stream issues
- **Authentication Failures**: Security-related alerts
- **Performance Degradation**: Resource usage alerts

---

## üîå Hardware Integration Patterns

### **Connection Management**
```python
class CameraConnection:
    """Standard camera connection pattern"""
    
    def __init__(self, camera_config):
        self.config = camera_config
        self.session = None
        self.websocket = None
        self.rtsp_client = None
    
    async def connect(self):
        """Establish connection with proper error handling"""
        try:
            # HTTP connection
            self.session = aiohttp.ClientSession()
            
            # WebSocket connection
            self.websocket = await self.session.ws_connect(
                f"wss://{self.config.host}/ws"
            )
            
            # RTSP stream
            self.rtsp_client = RTSPClient(self.config)
            
        except Exception as e:
            await self.handle_connection_error(e)
    
    async def handle_connection_error(self, error):
        """Standard error handling for connection failures"""
        # Implementation details...
```

### **Stream Management**
- **Video Streams**: Handle multiple concurrent streams
- **Quality Settings**: Dynamic quality adjustment
- **Buffer Management**: Proper buffering for smooth playback
- **Error Recovery**: Automatic stream recovery

### **Device Control**
- **PTZ Operations**: Pan, tilt, zoom controls
- **Preset Management**: Camera position presets
- **Night Vision**: IR and night mode controls
- **Audio**: Microphone and speaker controls

---

## üìù Documentation Templates

### **Camera Integration Guide**
```markdown
# Camera Integration Guide

## Supported Models
- [Camera Model List](#supported-models)

## Connection Setup
- [Network Configuration](#network-config)
- [Authentication](#authentication)
- [Initial Setup](#initial-setup)

## API Reference
- [Camera Operations](#camera-operations)
- [Streaming API](#streaming-api)
- [Device Control](#device-control)

## Troubleshooting
- [Common Issues](#common-issues)
- [Error Codes](#error-codes)
- [Diagnostics](#diagnostics)
```

### **Hardware Troubleshooting Template**
```markdown
# Hardware Troubleshooting Guide

## Connection Issues
### Problem: Camera Not Found
**Symptoms**: Camera doesn't appear in device list
**Solutions**:
1. Check network connectivity
2. Verify camera IP address
3. Check firewall settings
4. Restart camera

### Problem: Authentication Failed
**Symptoms**: Login attempts fail
**Solutions**:
1. Verify credentials
2. Check camera firmware version
3. Reset camera to factory defaults
4. Update MCP server credentials
```

---

## üöÄ Development Workflow

### **Hardware Testing**
- **Local Testing**: Test with physical cameras
- **Simulation**: Use camera simulators for development
- **Integration Testing**: Test with multiple camera models
- **Performance Testing**: Load testing with many cameras

### **Deployment Considerations**
- **Network Requirements**: Document network setup
- **Hardware Compatibility**: List supported devices
- **Performance Requirements**: Minimum system specs
- **Security Requirements**: Security configuration

### **Maintenance Procedures**
- **Firmware Updates**: Handle camera firmware updates
- **Configuration Backup**: Backup camera settings
- **Log Rotation**: Manage log files
- **Health Monitoring**: Regular system checks

---

## üìã Quality Checklist

### **Hardware Integration**
- [ ] All supported camera models tested
- [ ] Connection error handling implemented
- [ ] Authentication security verified
- [ ] Stream quality optimized
- [ ] Performance benchmarks met

### **Documentation**
- [ ] Camera setup guide complete
- [ ] API documentation up-to-date
- [ ] Troubleshooting guide comprehensive
- [ ] Security guidelines documented
- [ ] Hardware requirements specified

### **Security**
- [ ] Credentials encrypted and secure
- [ ] Network communications secured
- [ ] Access controls implemented
- [ ] Audit logging enabled
- [ ] Security testing completed

---

**Status**: ‚úÖ Active  
**Last Updated**: January 2025  
**Version**: 1.0.0  
**Purpose**: Hardware-specific guidelines for Tapo Camera MCP development
